{% extends 'header_footer.html' %}

{% block content %}

<form method="POST" action="{% url 'user:select_address' %}">
    {% csrf_token %}
    <div class="address-list">
        {% for address in addresses %}
        <div class="address-card">
            <p><strong>{{ address.full_name }}</strong></p>
            <p>{{ address.address }}, {{ address.area }}, {{ address.city }}, {{ address.state }} - {{ address.pincode }}</p>
            <p>{{ address.landmark }}</p>
            <p>{{ address.phone_number }}</p>
            <button type="submit" name="address_id" value="{{ address.id }}">Select Address</button>
        </div>
        {% endfor %}
    </div>
</form>

    <button class="add-address-btn" onclick="showAddressForm()">+ Add New Address</button>

    <!-- Address Form Section -->
    <div id="address-form-section" class="hidden">
        <h2>Add Delivery Address</h2>
        <form action="{% url 'address:address_list' %}" method="POST" class="address-form">
            {% csrf_token %}
            <div class="input-row">

                <div class="input-group">
                    <label for="phone-number">Phone Number</label>
                    <input type="tel" id="phone-number" name="phone_number" placeholder="Enter your phone number" required>
                </div>

                <div class="input-group">
                    <label for="pincode">Pincode</label>
                    <input type="text" id="pincode" name="pincode" placeholder="Pincode" required>
                </div>
                <div class="input-group">
                    <label for="city">City</label>
                    <input type="text" id="city" name="city" placeholder="City" required>
                </div>
                <div class="input-group">
                    <label for="state">State</label>
                    <select id="state" name="state" required>
                        <option value="" disabled selected>State</option>
                        <option value="kerala">Kerala</option>
                        <option value="tamil-nadu">Tamil Nadu</option>
                    </select>
                </div>
            </div>
            <div class="input-group">
                <label for="full_name">Full Name</label>
                <input type="text" id="full_name" name="full_name" placeholder="Full name" required>
            </div>
            <div class="input-group">
                <label for="address">House no / Building / Apartment</label>
                <input type="text" id="address" name="address" placeholder="House no / Building / Apartment" required>
            </div>
            <div class="input-group">
                <label for="area">Area, Sector, Street, Village</label>
                <input type="text" id="area" name="area" placeholder="Area, Sector, Street, Village">
            </div>
            <div class="input-group">
                <label for="address_type">Address Type</label>
                <select id="address_type" name="address_type" required>
                    <option value="" disabled selected>Select Address Type</option>
                    <option value="Home">Home</option>
                    <option value="Office">Office</option>
                </select>
            </div>
            <div class="input-group">
                <label for="landmark">Add landmark (optional)</label>
                <input type="text" id="landmark" name="landmark" placeholder="Landmark (optional)">
            </div>
            <button type="submit" class="save-btn">Save Address</button>
        </form>
    </div>
</main>

<style>
    .address-container { max-width: 600px; margin: auto; padding: 20px; }
    .address-list { margin-bottom: 20px; }
    .address-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
    .add-address-btn, .save-btn { background-color: #007bff; color: #fff; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
    .add-address-btn:hover, .save-btn:hover { background-color: #0056b3; }
    .input-group { margin-bottom: 15px; }
    .input-group label { display: block; font-weight: bold; margin-bottom: 5px; }
    .input-group input, .input-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    .hidden { display: none; }
</style>

<script>
    function showAddressForm() {
        document.getElementById('address-form-section').classList.toggle('hidden');
    }


    document.addEventListener('DOMContentLoaded', function () {
        const selectButtons = document.querySelectorAll('.select-address-btn');

        selectButtons.forEach(button => {
            button.addEventListener('click', function () {
                const addressId = this.closest('.address-card').getAttribute('data-address-id');

                fetch("{% url 'user:select_address' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ address_id: addressId })
                }).then(response => {
                    if (response.ok) {
                        window.location.href = "{% url 'user:checkout' %}";
                    }
                });
            });
        });
    });
</script>
{% endblock %}